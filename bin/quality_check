#!/bin/bash

# Quality check script for AdLocal Rails application
# Run all code quality checks

set -e

echo "ğŸ” Running AdLocal Quality Checks..."
echo "=================================="

# Check if we're in the right directory
if [ ! -f "Gemfile" ]; then
  echo "âŒ Error: Please run this script from the Rails application root directory"
  exit 1
fi

echo ""
echo "ğŸ“¦ Checking Ruby code quality with RuboCop..."
if bundle exec rubocop; then
  echo "âœ… Ruby code quality: PASSED"
else
  echo "âŒ Ruby code quality: FAILED"
  exit 1
fi

echo ""
echo "ğŸ”’ Running security check with Brakeman..."
if bundle exec brakeman --no-pager; then
  echo "âœ… Security check: PASSED"
else
  echo "âš ï¸  Security check: WARNINGS FOUND (review above)"
fi

echo ""
echo "ğŸ“ Checking JavaScript code quality with ESLint..."
if npx eslint app/javascript/; then
  echo "âœ… JavaScript code quality: PASSED"
else
  echo "âŒ JavaScript code quality: FAILED"
  exit 1
fi

echo ""
echo "ğŸ¨ Checking CSS code quality with Stylelint..."
if npx stylelint "app/assets/**/*.css"; then
  echo "âœ… CSS code quality: PASSED"
else
  echo "âŒ CSS code quality: FAILED"
  exit 1
fi

echo ""
echo "ğŸ§ª Running Rails tests..."
if bundle exec rails test; then
  echo "âœ… Rails tests: PASSED"
else
  echo "âŒ Rails tests: FAILED"
  exit 1
fi

echo ""
echo "ğŸ‰ All quality checks completed successfully!"
echo "Your code is ready for commit! ğŸš€"
