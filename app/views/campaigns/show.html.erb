<%# Campaign Show Page %>
<div class="container py-5">
  <%# Campaign Header %>
  <div class="d-flex justify-content-between align-items-start mb-4">
    <div>
      <h1 class="display-5 fw-bold text-dark mb-2"><%= @campaign.name %></h1>
      <div class="d-flex align-items-center gap-3">
        <span class="badge <%= @campaign.status_badge_class %> px-3 py-2 fs-6">
          <%= @campaign.status.titleize %>
        </span>
        <span class="text-muted">
          <i class="bi bi-calendar3 me-1"></i>
          Created <%= time_ago_in_words(@campaign.created_at) %> ago
        </span>
      </div>
    </div>
    <div class="d-flex gap-2">
      <% if @campaign.can_edit? %>
        <%= link_to "Edit", edit_campaign_path(@campaign), class: "btn btn-outline-primary" %>
      <% end %>
    </div>
  </div>

        <%# Campaign Completion Status %>
        <div class="card mb-4 border-0 shadow-sm">
          <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold text-dark">
              <i class="bi bi-check-circle text-primary me-2"></i>
              Campaign Completion
            </h5>
            <span class="badge bg-<%= @campaign.completion_percentage == 100 ? 'success' : (@campaign.completion_percentage >= 80 ? 'info' : 'warning') %> px-3 py-2">
              <%= @campaign.completion_percentage %>%
            </span>
          </div>
          <div class="card-body">
            <div class="alert <%= @campaign.completion_status_class %> mb-3">
              <i class="bi <%= @campaign.completion_status_icon %> me-2"></i>
              <strong><%= @campaign.completion_status_message %></strong>
            </div>
            
            <% unless @campaign.campaign_brief_complete? %>
              <div class="alert alert-warning mb-3">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <strong>Campaign Incomplete</strong> - The following information is still needed:
              </div>
              <ul class="list-unstyled mb-3">
                <% @campaign.missing_fields.each do |field| %>
                  <li class="d-flex align-items-center mb-2">
                    <i class="bi bi-x-circle text-danger me-2"></i>
                    <%= field %>
                  </li>
                <% end %>
              </ul>
              <div class="d-flex justify-content-center">
                <%= link_to "Complete Campaign", edit_campaign_path(@campaign), class: "btn btn-outline-primary" %>
              </div>
            <% end %>
          </div>
        </div>

  <%# Tab Navigation %>
  <ul class="nav nav-tabs mb-4" id="campaignTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="brief-tab" data-bs-toggle="tab" data-bs-target="#brief" type="button" role="tab" aria-controls="brief" aria-selected="true">
        1 Campaign Information
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="background-tab" data-bs-toggle="tab" data-bs-target="#background" type="button" role="tab" aria-controls="background" aria-selected="false">
        2 Generate Background Image
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="create-tab" data-bs-toggle="tab" data-bs-target="#create" type="button" role="tab" aria-controls="create" aria-selected="false">
        3 Create Ads
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="inventory-tab" data-bs-toggle="tab" data-bs-target="#inventory" type="button" role="tab" aria-controls="inventory" aria-selected="false">
        4 Choose Inventory
      </button>
    </li>
  </ul>

  <%# Tab Content %>
  <div class="tab-content" id="campaignTabsContent">
    <%# Tab 1: Campaign Brief %>
    <div class="tab-pane fade show active" id="brief" role="tabpanel" aria-labelledby="brief-tab">
      <div class="row">
        <div class="col-12">

      <% if @campaign.brief.present? %>
        <div class="card mb-4 border-0 shadow-sm">
          <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold text-dark">
              <i class="bi bi-file-text text-primary me-2"></i>
              Campaign Brief
            </h5>
            <%= link_to "Edit", edit_campaign_path(@campaign), class: "btn btn-outline-primary btn-sm" %>
          </div>
          <div class="card-body">
            <p class="mb-0 fs-5"><%= simple_format(@campaign.brief) %></p>
          </div>
        </div>
      <% end %>

      <%# Campaign Details %>
      <div class="row">
        <% if @campaign.goals.present? %>
          <div class="col-md-6 mb-4">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h6 class="mb-0 fw-bold text-dark">
                  <i class="bi bi-bullseye text-primary me-2"></i>
                  Goals
                </h6>
              </div>
              <div class="card-body">
                <p class="mb-0"><%= simple_format(@campaign.goals) %></p>
              </div>
            </div>
          </div>
        <% end %>

        <% if @campaign.audience.present? %>
          <div class="col-md-6 mb-4">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h6 class="mb-0 fw-bold text-dark">
                  <i class="bi bi-people text-primary me-2"></i>
                  Target Audience
                </h6>
              </div>
              <div class="card-body">
                <p class="mb-0"><%= simple_format(@campaign.audience) %></p>
              </div>
            </div>
          </div>
        <% end %>

        <% if @campaign.offer.present? %>
          <div class="col-md-6 mb-4">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h6 class="mb-0 fw-bold text-dark">
                  <i class="bi bi-gift text-primary me-2"></i>
                  Offer Details
                </h6>
              </div>
              <div class="card-body">
                <p class="mb-0"><%= simple_format(@campaign.offer) %></p>
              </div>
            </div>
          </div>
        <% end %>

        <% if @campaign.cta.present? %>
          <div class="col-md-6 mb-4">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-header bg-white border-bottom">
                <h6 class="mb-0 fw-bold text-dark">
                  <i class="bi bi-cursor text-primary me-2"></i>
                  Call to Action
                </h6>
              </div>
              <div class="card-body">
                <p class="mb-0 fw-bold fs-5"><%= @campaign.cta %></p>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <%# Brand Profile %>
      <% if @campaign.brand_colors_array.any? || @campaign.brand_fonts.present? || @campaign.tone_words_array.any? %>
        <div class="card mb-4 border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h5 class="mb-0 fw-bold text-dark">
              <i class="bi bi-palette text-primary me-2"></i>
              Brand Profile
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <% if @campaign.brand_colors_array.any? %>
                <div class="col-md-4 mb-3">
                  <h6 class="fw-bold mb-2">Brand Colors</h6>
                  <div class="d-flex flex-wrap gap-2">
                    <% @campaign.brand_colors_array.each do |color| %>
                      <div class="d-flex align-items-center">
                        <div class="me-2" style="width: 20px; height: 20px; background-color: <%= color %>; border-radius: 3px; border: 1px solid #ddd;"></div>
                        <span class="small text-muted"><%= color %></span>
                      </div>
                    <% end %>
                  </div>
                </div>
              <% end %>

              <% if @campaign.brand_fonts.present? %>
                <div class="col-md-4 mb-3">
                  <h6 class="fw-bold mb-2">Brand Fonts</h6>
                  <p class="mb-0 text-muted"><%= @campaign.brand_fonts %></p>
                </div>
              <% end %>

              <% if @campaign.tone_words_array.any? %>
                <div class="col-md-4 mb-3">
                  <h6 class="fw-bold mb-2">Tone Words</h6>
                  <div class="d-flex flex-wrap gap-1">
                    <% @campaign.tone_words_array.each do |word| %>
                      <span class="badge bg-light text-dark border"><%= word %></span>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <%# Assets %>
      <div class="card mb-4 border-0 shadow-sm">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0 fw-bold text-dark">
            <i class="bi bi-image text-primary me-2"></i>
            Assets
          </h5>
        </div>
        <div class="card-body">
          <%# Business Logo %>
          <% if @campaign.business_logo %>
            <div class="mb-4">
              <h6 class="fw-bold mb-2">Business Logo</h6>
              <%= image_tag @campaign.business_logo, class: "img-thumbnail", style: "width: 100px; height: 100px; object-fit: contain;" %>
            </div>
          <% end %>

          <%# Inspiration Images %>
          <% if @campaign.has_inspiration_images? %>
            <div>
              <h6 class="fw-bold mb-3">Inspiration Images</h6>
              <div class="row g-2">
                <% @campaign.inspiration_images.each do |image| %>
                  <div class="col-6">
                    <%= image_tag image, class: "img-thumbnail w-100", style: "height: 100px; object-fit: cover;" %>
                  </div>
                <% end %>
              </div>
            </div>
          <% else %>
            <p class="text-muted mb-0">No inspiration images uploaded</p>
          <% end %>
        </div>
      </div>

      <%# Ad Sizes %>
      <% if @campaign.ad_sizes_array.any? %>
        <div class="card mb-4 border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h5 class="mb-0 fw-bold text-dark">
              <i class="bi bi-aspect-ratio text-primary me-2"></i>
              Selected Ad Sizes
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <%# Left Column - 4 items %>
              <div class="col-md-6">
                <% if @campaign.ad_sizes_array.include?("300x250") %>
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <div>
                      <div class="fw-bold">300×250 (Medium Rectangle)</div>
                      <p class="text-muted small mb-0">Standard banner size</p>
                    </div>
                  </div>
                <% end %>
                
                <% if @campaign.ad_sizes_array.include?("336x280") %>
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <div>
                      <div class="fw-bold">336×280 (Large Rectangle)</div>
                      <p class="text-muted small mb-0">Enhanced banner size</p>
                    </div>
                  </div>
                <% end %>
                
                <% if @campaign.ad_sizes_array.include?("728x90") %>
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <div>
                      <div class="fw-bold">728×90 (Leaderboard)</div>
                      <p class="text-muted small mb-0">Wide banner for headers</p>
                    </div>
                  </div>
                <% end %>
                
                <% if @campaign.ad_sizes_array.include?("970x250") %>
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <div>
                      <div class="fw-bold">970×250 (Billboard)</div>
                      <p class="text-muted small mb-0">Large format display</p>
                    </div>
                  </div>
                <% end %>
              </div>
              
              <%# Right Column - 4 items %>
              <div class="col-md-6">
                <% if @campaign.ad_sizes_array.include?("160x600") %>
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <div>
                      <div class="fw-bold">160×600 (Wide Skyscraper)</div>
                      <p class="text-muted small mb-0">Sidebar placement</p>
                    </div>
                  </div>
                <% end %>
                
                <% if @campaign.ad_sizes_array.include?("300x600") %>
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <div>
                      <div class="fw-bold">300×600 (Half Page)</div>
                      <p class="text-muted small mb-0">Large vertical banner</p>
                    </div>
                  </div>
                <% end %>
                
                <% if @campaign.ad_sizes_array.include?("320x50") %>
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <div>
                      <div class="fw-bold">320×50 (Mobile Banner)</div>
                      <p class="text-muted small mb-0">Mobile-optimized</p>
                    </div>
                  </div>
                <% end %>
                
                <% if @campaign.ad_sizes_array.include?("1080x1080") %>
                  <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <div>
                      <div class="fw-bold">1080×1080 (Square / Social)</div>
                      <p class="text-muted small mb-0">Perfect for social media</p>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
        </div>
      </div>
    </div>

    <%# Tab 2: Generate Background Image %>
    <div class="tab-pane fade" id="background" role="tabpanel" aria-labelledby="background-tab">
      <div class="row">
        <div class="col-12">
          <%# Background Image Generation Interface %>
          <% if @campaign.can_generate_ads? %>
            <div data-controller="ad-generation" data-ad-generation-campaign-id-value="<%= @campaign.id %>">
              <div class="d-flex justify-content-center gap-2 mb-3">
                <button data-ad-generation-target="button" 
                        data-action="click->ad-generation#generateAds"
                        class="btn btn-outline-primary btn-lg">
                  <i class="bi bi-magic me-2"></i>
                  Generate Image
                </button>
              </div>
              
              <!-- Progress Section -->
              <div data-ad-generation-target="progress" style="display: none;" class="mb-4">
                <div class="alert alert-info">
                  <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-3" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <div class="flex-grow-1">
                      <div data-ad-generation-target="status" class="fw-bold">Preparing image generation...</div>
                      <div class="progress mt-2" style="height: 8px;">
                        <div data-ad-generation-target="progressBar" 
                             class="progress-bar bg-primary" 
                             role="progressbar" 
                             style="width: 0%" 
                             aria-valuenow="0" 
                             aria-valuemin="0" 
                             aria-valuemax="100"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Error Messages -->
              <div data-ad-generation-target="error"></div>
              
              <!-- Generated Background Image Display -->
              <div data-ad-generation-target="backgroundImage" class="mb-4" style="display: none;">
                <!-- Content will be populated by JavaScript -->
              </div>
            </div>
          <% elsif @campaign.has_background_image? %>
            <%# Background Image Already Generated %>
            <div class="alert alert-success mb-3">
              <i class="bi bi-check-circle me-2"></i>
              <strong>Background image generated!</strong> You can now proceed to create ads.
            </div>
            
            <div data-controller="ad-generation" data-ad-generation-campaign-id-value="<%= @campaign.id %>">
              <!-- Progress Section -->
              <div data-ad-generation-target="progress" style="display: none;" class="mb-4">
                <div class="alert alert-info">
                  <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-3" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <div class="flex-grow-1">
                      <div data-ad-generation-target="status" class="fw-bold">Preparing image generation...</div>
                      <div class="progress mt-2" style="height: 8px;">
                        <div data-ad-generation-target="progressBar" 
                             class="progress-bar bg-primary" 
                             role="progressbar" 
                             style="width: 0%" 
                             aria-valuenow="0" 
                             aria-valuemin="0" 
                             aria-valuemax="100"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Error Messages -->
              <div data-ad-generation-target="error"></div>
              
              <!-- Generated Background Images Display -->
              <div data-ad-generation-target="backgroundImage" class="mb-4">
                <div class="row g-3">
                  <% 
                  # Show all three background variants from the database
                  # These are independent of the selected ad sizes
                  variants = []
                  @campaign.background_variants.each do |variant|
                    variants << {
                      name: variant.aspect.capitalize,
                      variant: variant,
                      size: variant.size
                    }
                  end
                  %>
                  
                  <% if variants&.any? %>
                    <% variants.each do |variant| %>
                      <div class="col-md-4">
                        <div class="card border-0 shadow-sm">
                          <div class="card-header bg-white border-bottom">
                            <h6 class="mb-0 fw-bold text-dark">
                              <i class="bi bi-image text-primary me-2"></i>
                              <%= variant[:name] %> Background
                            </h6>
                          </div>
                          <div class="card-body text-center">
                            <img src="<%= variant[:variant].image_url %>"  
                                 class="img-fluid rounded mb-2" 
                                 style="max-height: 200px; border: 2px solid #dee2e6;"
                                 alt="<%= variant[:name] %> background">
                            <p class="text-muted small mb-0"><%= variant[:size] %></p>
                          </div>
                        </div>
                      </div>
                    <% end %>
                  <% else %>
                    <div class="col-12">
                      <div class="alert alert-info text-center">
                        <i class="bi bi-info-circle me-2"></i>
                        Background images will appear here after generation.
                      </div>
                    </div>
                  <% end %>
                </div>
                
                <div class="text-center mt-3">
                  <button data-ad-generation-target="regenerateButton" 
                          data-action="click->ad-generation#regenerateImage"
                          class="btn btn-outline-warning">
                    <i class="bi bi-arrow-clockwise me-2"></i>
                    Regenerate Images
                  </button>
                </div>
              </div>
            </div>
          <% else %>
            <div class="alert alert-warning mb-3">
              <i class="bi bi-exclamation-triangle me-2"></i>
              <strong>Campaign Incomplete</strong> - Complete the campaign brief first before generating background images.
            </div>
            <div class="d-flex justify-content-center">
              <%= link_to "Complete Campaign", edit_campaign_path(@campaign), class: "btn btn-outline-primary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <%# Tab 3: Create Ads %>
    <div class="tab-pane fade" id="create" role="tabpanel" aria-labelledby="create-tab">
      <div class="row">
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0 fw-bold text-dark">
                <i class="bi bi-palette text-primary me-2"></i>
                Create Ads
              </h5>
            </div>
            <div class="card-body">
              <div class="text-center py-5">
                <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                <h4 class="text-muted mt-3">Tab 3 - Create Ads</h4>
                <p class="text-muted">This tab will contain the ad creation interface.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-pane fade" id="inventory" role="tabpanel" aria-labelledby="inventory-tab">
      <div class="row">
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0 fw-bold text-dark">
                <i class="bi bi-grid text-primary me-2"></i>
                Choose Inventory
              </h5>
            </div>
            <div class="card-body">
              <p class="text-muted">Inventory selection functionality will be implemented here.</p>
              <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                This section will allow you to select specific inventory placements for your campaign.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
